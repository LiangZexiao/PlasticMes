using System;
using System.Data;
using System.Data.SqlClient;
using System.Configuration;
using System.Collections;
using System.Drawing.Imaging;
using System.IO;

using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Web.UI.HtmlControls;
using Admin.DBUtility;

public partial class ShowImage : System.Web.UI.Page
{
    string Index        = string.Empty;
    string TableName    = string.Empty;
    string ImgType      = string.Empty;
    string Img          = string.Empty;

    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
        {
            if (Request.QueryString["ID"] != null && Request.QueryString["TableName"] != null)// &&
               // Request.QueryString["ImgType"] != null && Request.QueryString["Img"] != null)//基本资料的图片
            {
                Index       = Request.QueryString["ID"].ToString().Trim();
                TableName   = Request.QueryString["TableName"].ToString().Trim();
                ImgType = Request.QueryString["ImgType"].ToString().Trim();
                Img         = Request.QueryString["Img"].ToString().Trim();
                 
                string strSQL = string.Format("SELECT * FROM {0} WHERE ID='{1}'", TableName, Index);
                using (SqlDataReader sdr = SqlHelper.ExecuteReader(CommandType.Text, strSQL, null))
                {
                    if (sdr.Read())
                    {
                        Response.Clear();
                        Response.ContentType = "image/pjpeg";//sdr[ImgType].ToString();
                        byte[] imageByte=null;
                        if (sdr[Img] ==DBNull.Value) return;
                        if (((byte[])sdr[Img]).Length > 2)
                        {
                           // Response.BinaryWrite((byte[])sdr[Img]);//图片数据
                            imageByte=(byte[])sdr[Img];
                        }
                        //else
                        //{
                        //   // string kks = "0xFFD8FFE000104A46494600010101006000600000FFDB004300080606070605080707070909080A0C140D0C0B0B0C1912130F141D1A1F1E1D1A1C1C20242E2720222C231C1C2837292C30313434341F27393D38323C2E333432FFDB0043010909090C0B0C180D0D1832211C213232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232FFC00011080082006E03012200021101031101FFC4001F0000010501010101010100000000000000000102030405060708090A0BFFC400B5100002010303020403050504040000017D01020300041105122131410613516107227114328191A1082342B1C11552D1F02433627282090A161718191A25262728292A3435363738393A434445464748494A535455565758595A636465666768696A737475767778797A838485868788898A92939495969798999AA2A3A4A5A6A7A8A9AAB2B3B4B5B6B7B8B9BAC2C3C4C5C6C7C8C9CAD2D3D4D5D6D7D8D9DAE1E2E3E4E5E6E7E8E9EAF1F2F3F4F5F6F7F8F9FAFFC4001F0100030101010101010101010000000000000102030405060708090A0BFFC400B51100020102040403040705040400010277000102031104052131061241510761711322328108144291A1B1C109233352F0156272D10A162434E125F11718191A262728292A35363738393A434445464748494A535455565758595A636465666768696A737475767778797A82838485868788898A92939495969798999AA2A3A4A5A6A7A8A9AAB2B3B4B5B6B7B8B9BAC2C3C4C5C6C7C8C9CAD2D3D4D5D6D7D8D9DAE2E3E4E5E6E7E8E9EAF2F3F4F5F6F7F8F9FAFFDA000C03010002110311003F00F7A9E5F2514852C5982819C726A2F3AE7FE7D3FF00220A5BCFF961FF005D96B80F1478F755D13C4775A7DBC166F0C5B36B488C5B940C738603A9AD68D19D6972C0C6BD78508F34F63BEF3AE7FE7D3FF220A3CEB9FF009F4FFC882BCAFF00E1696BBFF3EBA77FDFA7FF00E2E947C52D73BDAE9FFF007EDFFF008BAE9FECEAFE5F79CBFDA787F33D4FCEB9FF009F4FFC8828F3AE7FE7D3FF00220AF2DFF85A3ADFFCFAE9FF00F7EDFF00F8BA77FC2CFD731FF1EBA763FEB9BFFF001747F67D7F2FBC7FDA543CFEE3D43CEB9FF9F4FF00C8828F3AE7FE7D3FF220AF2F1F13B5BC7FC7AE9FFF007EDFFF008BA5FF00859DADF7B5D3FF00EFDBFF00F1747F67D61FF68D0F3FB8F4FF003AE7FE7D3FF220A3CEB9FF009F4FFC882BCC87C4DD6FFE7D6C3FEFDBFF00F174A3E256B447FC7AD87FDFB7FF00E2A97F67D60FED0A3E7F71E99E75CFFCFA7FE441479D73FF003E9FF910579AFF00C2C9D64FFCBB587FDF0FFF00C552FF00C2C9D6BFE7D6C3FEF87FFE2A8FA8561FF6851F33D27CEB9FF9F4FF00C8829D1DC334A6392228DB7701BB3C5713E1CF1AEA7AC6BB6F65710DA2C526EDCD1A303C293C658FA7A576BFF313FF00B63FD6B9EAD2952972C8E8A55A35573442F3FE587FD765AF1CF1F293E35BFE38FDDFFE8B5AF63BCFF961FF005D96BC8BC76B9F195F7D23FF00D16B5D796FF15FA7F91C799ABD15EBFA339655E7914ED9EDFA54BB29C1715ED5CF0D44876FB52EDE3A54C569427145CAE522D991D0D382FB54C131DA9C1318A571D887671D29E23E6A50BC0A5DBCD2B8EC44AB4FDBD38A9027B53C252B8EC6D782571E2DB2FF0081FF00E80D5EA9FF00313FFB63FD6BCC7C18B8F15599FF007FFF00406AF4EFF989FF00DB1FEB5E3661FC55E87B3977F09FAFF905E7FCB0FF00AECB5E4DE3819F18DF1C7FCF3FFD16B5EB379FF2C3FEBB2D79578D867C5D7A7DA3FF00D0169E5FFC57E9FE4198FF00097A9CDEDF6A50B835205E29DB7A715EC5CF1AC44171CE29E17DA9E17A714E0828B81185E69DB7D0548140229C1695C6336F4A509CD48129DB79A570B1185F6A902D3828C53C2F14AE3B1B3E0F18F13D9FFC0FFF00406AF49FF989FF00DB1FEB5E75E1118F12DA7FC0FF00F4035E8BFF00313FFB63FD6BC8C7FF00117A1EC65FFC27EBFE4179FF002C3FEBB2D796F8D067C5B7A7FDCFFD016BD4AF3FE587FD765AF33F16C12DC78BEEE3851E476D98555C93F22F414F00ED51FA7F90660AF497A9CE05E3AD3B6F22B5E3F0C6B52FDDD3E7FF008100BFCEA53E15D69464E9F263D8A9FE46BD3F6D0FE65F79E57B19FF002BFB8C50BC5382E454F1DB4B25C0812373296DA131CE7D315A09E1DD59AE1A0165209157790C4018FAE714DCE2B7628C252D9192179A785C1A96485E295A3950A3A9C3291820D5BB1D22F751C9B680B20EB231DAA3F13C50E692BB7A028393B25A9482F02971CD6AFF00C23DAB6F29F619B2BFECF07F1E95527B49ED25315C42F13F5C30C52538BD1329C24B568AC178A785AD15D135036A9722D2568A4FBA54649F4E3AD0DA45FA5A0BA7B590439C671EF8E4751CD4FB48F70F672EC5BF0A0C7892D7FE07FF00A01AF41FF989FF00DB1FEB5C1785971E21B6FF0081FF00E826BBDFF989FF00DB1FEB5E663BF88BD0F5701FC37EBFE4179FF2C3FEBB2D71D2123E26B2E090E369C7503CAEA2BB1BCFF961FF005D96B8CBBB98AD3E22C934EE234C01BCF45262001A8C32BF3AFEEB34C4BB723FEF239B9249A68600F713CA599812667E704F72368E39C0DD5ABA3DA67FB3D9D2EA39DAFA30CE558215C31C03B8EECED1DB8A735B5B0B5B6B6BAF105A2ADB29555821790727D4100FE5566D1AD20368175F81ED6DA713F97F656424E3071D7B1FD6BE7A965F88525274DDB4FD0FA9AD9A615C1C235127AF7F3F220D18BCDE3833EC07F7F2B36070010DCD545D51A6D1E3B497548A28A36CE12DDE490E1895DCC78EBCF06ACDA5E5A4B06A56DF6B92C3ED52EF598296F93272A71CF435A115FD95E58DC69314F1DB5AC6211019F8DC15F7393C7538E95ECE6587AF5E7EE46CA31FBEFD34678394E2B0F8782E795DCA5E5A5AFAEA991A5DC5AD58DF413DFA5D4D1C26653F64F28C6579249F7E9F8D52D61251E1CD300F3BC8584B48C9BB672DC02385CE7DF3ED4FD635EB8BD9EE6186402D5DB00AA005D474C9EB8A6E9B324DA3DF69D25F080CA14279A49403396C0F5AAAD81ADF5195393BBDFAFEA4D0CC682CC635631B2DBA7DFA25F919A2F25786395AE9D9238C1749679009189C60618F41CF6EFC5745791A7D9AC2CAF8DBBDCF9C82210BBB6D889E7733F27359F3E976F736C618B58B2E71F7CCCB8C7FBCC47E949AC5CC171AD19A3224880404AF00E00071ED5CB94E0EAC2B3751356475E778FA152846349A777A86AB737A9E23B8303DF2132796C15C40BE5A83B429391D89C9F7A85B53D5BFB566985C6A2654558D8ADAAE55739208E9C0E41EF5A37434ABED45EF1B52B813484344AD1E238881C061DFA76A908B768D122D5B6EA51CBE7B5EB21DAEC460AFD318F6E2B8A580C57349D9EF7FEBCCEF866782E58ABC6F64B6FF0081B74FF32EDBA44FE27B0BC8D1E2FB546D2189C00CBF2919207AF5FCEBA5FF00989FFDB1FEB5CCDA5C4575E2DB69627F3084224902901D821C900F41D2BA6FF989FF00DB1FEB5ED55524A2A5BD91F3D45C5B9B8ED76179FF002C3FEBB2D79CF8B467C4F77FF00FFD0057A35E7FCB0FFAECB5E75E2CFF00919AEFFE01FF00A00ADF03FC47E8638FFE12F53100A781D2900E29C3815EA9E40A07069C07B5005380E281801401CF029DDE940A900029C07B503AD385002819A900EF4D14F518C5481ADE1B1FF13DB7FF00817FE826BB4FF989FF00DB1FEB5C67873FE43B6E7FDEFF00D04D767FF313FF00B63FD6BCCC67F117A1EB603F86FD7FC82F3FE587FD765AF3BF16FF00C8CD77F44FFD0057A25E7FCB0FFAECB5E79E2CFF00919AEFFE01FF00A00AAC0FF11FA7F9063FF86BD4C5039A7819A681C53C0AF54F205029C2905385200C53850064D3956900A39A7A8C0A6E38A701486380A7639A414E031480D6F0E7FC872DFF00E05FFA09AECBFE627FF6C7FAD71DE1DFF90E5BFF00C0BFF4135D8FFCC4FF00ED8FF5AF3319FC45E87AD80FE1BF5FF20BCFF961FF005D96BCF3C59FF232DDFD13FF004015E8778AC5236552DB240C401CE28FB67FD3BDC7FDF15950ADECA5CD6B9BD7A3ED63CB7B1E4839A78E315EB1F6CFFA77B8FF00BE28FB67FD3BDC7FDF15D7F5FF00EEFE3FF00E4FECFF00EF7E1FF04F29029C057AA7DB3FE9DEE3FEF8A3ED9FF4EF71FF007C52FAFF00F77F1FF801FD9FFDEFC3FE09E5CB4EAF4FFB67FD3BDC7FDF147DB3FE9DEE3FEF8A3EBFFDDFC7FE00BFB3FF00BDF87FC13CC474A781EB5E97F6CFFA77B8FF00BE28FB67FD3BDC7FDF14BEBDFDDFC47FD9FF00DEFC3FE09E6A39A92BD1BED9FF004EF71FF7C51F6CFF00A77B8FFBE28FAEFF0077F10FECFF00EF7E1FF04E3BC3BFF21CB7FF00817FE826BB1FF989FF00DB1FEB47DB3FE9DEE3FEF8A6C45A5BC32F9722288F6FCE31CE6B9AB55F6B2E6B58EBA147D94796F72DD1451589B0514514005145140051451400514514005145140051451401FFD9";
                        //    //imageByte = System.Text.Encoding.Default.GetBytes(kks);
                        //    //Response.BinaryWrite(imageByte);
                        //}
                        if (imageByte == null) return;
                        Response.BinaryWrite(imageByte);
                        Response.End();
                    }
                }
            }

            if (Request.QueryString["Flag"] != null)//生成的曲线图
            {
                string SessionID = Request.QueryString["Flag"].ToString().Trim();

                Response.Clear();
                Response.ContentType = "image/jpeg"; //ImageFormat.Jpeg.ToString();
                
                byte[] temp = (byte[])Session[SessionID];
                if (temp == null) return;
                Response.BinaryWrite(temp);//图片数据

                Session[SessionID] = null;
                Response.End();                
            }
        }
    }
}